{% extends "base.html" %}
{% block title %}All Tea Businesses{% endblock %}

{% block head_extra %}
<style>
    .page-header {
        background: linear-gradient(135deg, #4a6f3d, #28a745);
        color: white;
        padding: 2rem;
        margin-bottom: 2rem;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .page-header h1 {
        margin-bottom: 0.5rem;
    }
    
    .filter-card {
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        margin-bottom: 20px;
        border: none;
    }
    
    .business-card {
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        margin-bottom: 20px;
        transition: transform 0.2s, box-shadow 0.2s;
        border: none;
        overflow: hidden;
    }
    
    .business-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.08);
    }
    
    .business-card .card-header {
        background: linear-gradient(to right, #f8f9fa, #ffffff);
        border-bottom: 1px solid rgba(0,0,0,0.05);
        padding: 15px 20px;
    }
    
    .business-card .card-body {
        padding: 1.25rem;
    }
    
    .business-type {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        font-size: 0.75rem;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-radius: 30px;
        margin-bottom: 10px;
        background-color: #e9ecef;
        color: #495057;
    }
    
    .business-location {
        color: #6c757d;
        font-size: 0.9rem;
        margin-bottom: 10px;
    }
    
    .business-location i {
        margin-right: 5px;
        color: #17a2b8;
    }
    
    .business-description {
        font-size: 0.9rem;
        color: #495057;
        margin-bottom: 15px;
        height: 60px;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
    }
    
    .business-footer {
        margin-top: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .business-region {
        display: inline-block;
        font-size: 0.8rem;
        color: #6c757d;
        padding: 2px 10px;
        background-color: #f8f9fa;
        border-radius: 30px;
        border: 1px solid #e9ecef;
    }
    
    .pagination-container {
        margin: 2rem 0;
    }
    
    .page-item.active .page-link {
        background-color: #28a745;
        border-color: #28a745;
    }
    
    .page-link {
        color: #28a745;
    }
    
    .action-btn {
        padding: 0.25rem 0.5rem;
        font-size: 0.8rem;
    }
    
    .view-btn {
        color: #17a2b8;
        margin-right: 5px;
        transition: all 0.2s;
    }
    
    .view-btn:hover {
        color: #138496;
    }
    
    .edit-btn {
        color: #28a745;
        margin-right: 5px;
        transition: all 0.2s;
    }
    
    .edit-btn:hover {
        color: #218838;
    }
    
    .delete-btn {
        color: #dc3545;
        transition: all 0.2s;
    }
    
    .delete-btn:hover {
        color: #c82333;
    }
    
    .stats-badge {
        background-color: #e9ecef;
        color: #495057;
        padding: 5px 15px;
        border-radius: 50px;
        font-weight: 500;
    }
    
    .listing-view-toggle {
        margin-bottom: 20px;
    }
    
    .listing-view-toggle .btn {
        border-radius: 0;
    }
    
    .listing-view-toggle .btn:first-child {
        border-top-left-radius: 4px;
        border-bottom-left-radius: 4px;
    }
    
    .listing-view-toggle .btn:last-child {
        border-top-right-radius: 4px;
        border-bottom-right-radius: 4px;
    }
    
    .table-view th {
        background-color: #f8f9fa;
        border-top: none;
        border-bottom: 2px solid #dee2e6;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-7">
                <h1><i class="fas fa-building mr-3"></i>All Tea Businesses</h1>
                <p class="lead text-white-50 mb-0">
                    Browse the complete database of tea businesses around the world
                </p>
            </div>
            <div class="col-md-5 text-md-right mt-3 mt-md-0">
                <div class="stats-badge">
                    <i class="fas fa-list mr-1"></i> Showing page {{ page }} of {{ total_pages }}
                </div>
                <a href="{{ url_for('add_business') }}" class="btn btn-light ml-2">
                    <i class="fas fa-plus-circle"></i> Add Business
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row mb-4">
        <div class="col-md-8">
            <form class="form-inline" method="GET">
                <div class="input-group flex-grow-1">
                    <input type="text" class="form-control" placeholder="Search businesses..." name="query">
                    <div class="input-group-append">
                        <button class="btn btn-outline-success" type="submit">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>
        <div class="col-md-4 text-md-right mt-3 mt-md-0">
            <div class="btn-group listing-view-toggle" role="group">
                <button type="button" class="btn btn-outline-secondary active" id="card-view-btn">
                    <i class="fas fa-th-large"></i> Card View
                </button>
                <button type="button" class="btn btn-outline-secondary" id="table-view-btn">
                    <i class="fas fa-list"></i> Table View
                </button>
            </div>
        </div>
    </div>
    
    <!-- Card View -->
    <div id="card-view">
        <div class="row">
            {% for business in businesses %}
            <div class="col-lg-4 col-md-6">
                <div class="business-card card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <a href="{{ url_for('business_detail', business_id=business['_id']|string) }}">
                                {{ business.get('Business Name', 'Unnamed Business') }}
                            </a>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="business-type">{{ business.get('Type', 'Unspecified Type') }}</div>
                        
                        <div class="business-location">
                            <i class="fas fa-map-marker-alt"></i> {{ business.get('Location', 'Location not specified') }}
                        </div>
                        
                        <div class="business-description">
                            {{ business.get('Description', 'No description available.')[:150] }}{% if business.get('Description', '')|length > 150 %}...{% endif %}
                        </div>
                        
                        <div class="business-footer">
                            <div class="business-region">
                                <i class="fas fa-globe-americas mr-1"></i> {{ business.get('Region', 'Unknown Region') }}
                            </div>
                            
                            <div class="business-actions">
                                <a href="{{ url_for('business_detail', business_id=business['_id']|string) }}" class="btn btn-sm btn-outline-info action-btn">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{{ url_for('edit_business', business_id=business['_id']|string) }}" class="btn btn-sm btn-outline-success action-btn">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <button type="button" class="btn btn-sm btn-outline-danger action-btn" onclick="confirmDelete('{{ business['_id']|string }}', '{{ business.get('Business Name', 'this business') }}')">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="col-12">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle mr-2"></i> No businesses found.
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <!-- Table View (hidden by default) -->
    <div id="table-view" style="display: none;">
        <div class="table-responsive">
            <table class="table table-hover table-view">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Location</th>
                        <th>Region</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                {% for business in businesses %}
                    <tr>
                        <td><a href="{{ url_for('business_detail', business_id=business['_id']|string) }}">{{ business.get('Business Name', 'Unnamed Business') }}</a></td>
                        <td>{{ business.get('Type', 'Unspecified') }}</td>
                        <td>{{ business.get('Location', 'Unknown') }}</td>
                        <td>{{ business.get('Region', 'Unknown') }}</td>
                        <td>
                            <a href="{{ url_for('business_detail', business_id=business['_id']|string) }}" class="btn btn-sm btn-outline-info action-btn">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="{{ url_for('edit_business', business_id=business['_id']|string) }}" class="btn btn-sm btn-outline-success action-btn">
                                <i class="fas fa-edit"></i>
                            </a>
                            <button type="button" class="btn btn-sm btn-outline-danger action-btn" onclick="confirmDelete('{{ business['_id']|string }}', '{{ business.get('Business Name', 'this business') }}')">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="5" class="text-center">No businesses found.</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div class="pagination-container">
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                <li class="page-item {% if page == 1 %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('business_list', page=page-1) if page > 1 else '#' }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="sr-only">Previous</span>
                    </a>
                </li>
                
                {% for p in range(1, total_pages + 1) %}
                    {% if p == page %}
                        <li class="page-item active">
                            <a class="page-link" href="#">{{ p }} <span class="sr-only">(current)</span></a>
                        </li>
                    {% elif p <= 3 or p >= total_pages-2 or p == page-1 or p == page+1 %}
                        <li class="page-item"><a class="page-link" href="{{ url_for('business_list', page=p) }}">{{ p }}</a></li>
                    {% elif p == 4 and page > 6 %}
                        <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
                    {% elif p == total_pages-3 and page < total_pages-5 %}
                        <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
                    {% endif %}
                {% endfor %}
                
                <li class="page-item {% if page == total_pages %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('business_list', page=page+1) if page < total_pages else '#' }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                        <span class="sr-only">Next</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
    {% endif %}
    
    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete <span id="businessNameToDelete"></span>?</p>
                    <p class="text-danger"><small>This action cannot be undone.</small></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <form id="deleteForm" method="POST">
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // View toggle functionality
    document.getElementById('card-view-btn').addEventListener('click', function() {
        document.getElementById('card-view').style.display = 'block';
        document.getElementById('table-view').style.display = 'none';
        this.classList.add('active');
        document.getElementById('table-view-btn').classList.remove('active');
    });
    
    document.getElementById('table-view-btn').addEventListener('click', function() {
        document.getElementById('card-view').style.display = 'none';
        document.getElementById('table-view').style.display = 'block';
        this.classList.add('active');
        document.getElementById('card-view-btn').classList.remove('active');
    });
});

function confirmDelete(businessId, businessName) {
    document.getElementById('businessNameToDelete').textContent = businessName;
    document.getElementById('deleteForm').action = "{{ url_for('delete_business_action', business_id='__id__') }}".replace('__id__', businessId);
    $('#deleteModal').modal('show');
}
</script>
{% endblock %}
